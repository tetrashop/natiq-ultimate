<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ Ù…Ø¯ÛŒØ±ÛŒØª - Ù†Ø§Ø·Ù‚ Ø§ÙˆÙ„ØªÛŒÙ…ÛŒØª</title>
    <style>
        body {
            font-family: 'Vazirmatn', sans-serif;
            background: #f8f9fa;
            padding: 20px;
        }
        
        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        .card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .stat-card {
            text-align: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .api-tester {
            background: #f1f8ff;
        }
        
        textarea, input {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-family: 'Vazirmatn', sans-serif;
        }
        
        button {
            background: #4361ee;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        
        .response-box {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin-top: 15px;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <h1>ğŸ“Š Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ Ù…Ø¯ÛŒØ±ÛŒØª Ù†Ø§Ø·Ù‚ Ø§ÙˆÙ„ØªÛŒÙ…ÛŒØª</h1>
    
    <div class="dashboard">
        <div class="card stat-card">
            <h3>Ø¢Ù…Ø§Ø± Ú©Ù„ÛŒ</h3>
            <div id="totalRequests">Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ...</div>
            <div id="activeSessions">Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ...</div>
            <div id="responseTimeAvg">Ø¯Ø± Ø­Ø§Ù„ Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ...</div>
        </div>
        
        <div class="card api-tester">
            <h3>ğŸ› ï¸ ØªØ³ØªØ± API</h3>
            <select id="endpointSelect">
                <option value="/api/chat">Ù…Ú©Ø§Ù„Ù…Ù‡ (chat)</option>
                <option value="/api/health">Ø³Ù„Ø§Ù…Øª (health)</option>
                <option value="/api/status">ÙˆØ¶Ø¹ÛŒØª (status)</option>
                <option value="/api/analyze-text">ØªØ­Ù„ÛŒÙ„ Ù…ØªÙ†</option>
            </select>
            
            <textarea id="requestBody" placeholder='{"message": "Ø³Ù„Ø§Ù…"}' rows="4"></textarea>
            <button onclick="testApi()">Ø§Ø±Ø³Ø§Ù„ Ø¯Ø±Ø®ÙˆØ§Ø³Øª</button>
            
            <div class="response-box" id="apiResponse"></div>
        </div>
        
        <div class="card">
            <h3>ğŸ“ Ù…Ø¯ÛŒØ±ÛŒØª Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§</h3>
            <input id="newQuestion" placeholder="Ø³ÙˆØ§Ù„ Ø¬Ø¯ÛŒØ¯">
            <textarea id="newAnswer" placeholder="Ù¾Ø§Ø³Ø®" rows="3"></textarea>
            <button onclick="learnResponse()">ÛŒØ§Ø¯Ú¯ÛŒØ±ÛŒ Ù¾Ø§Ø³Ø®</button>
            <button onclick="listResponses()">Ù†Ù…Ø§ÛŒØ´ Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§</button>
            
            <div class="response-box" id="responsesList"></div>
        </div>
        
        <div class="card">
            <h3>âš™ï¸ ØªÙ†Ø¸ÛŒÙ…Ø§Øª Ø³ÛŒØ³ØªÙ…</h3>
            <button onclick="clearAllMemory()">Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ ØªÙ…Ø§Ù… Ø­Ø§ÙØ¸Ù‡</button>
            <button onclick="restartServer()">Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ù…Ø¬Ø¯Ø¯ (Ù†Ù…Ø§ÛŒØ´ÛŒ)</button>
            
            <div style="margin-top: 20px;">
                <label>Ù…ÛŒØ²Ø§Ù† Ø­Ø§ÙØ¸Ù‡ Ù…Ú©Ø§Ù„Ù…Ù‡:</label>
                <input type="range" id="memoryLimit" min="1" max="50" value="10">
                <span id="limitValue">10 Ù¾ÛŒØ§Ù…</span>
            </div>
        </div>
    </div>

    <script>
        // Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø§ÙˆÙ„ÛŒÙ‡ Ø¢Ù…Ø§Ø±
        loadStats();
        
        async function loadStats() {
            try {
                const [healthRes, statusRes] = await Promise.all([
                    fetch('/api/health'),
                    fetch('/api/status')
                ]);
                
                const health = await healthRes.json();
                const status = await statusRes.json();
                
                document.getElementById('totalRequests').innerHTML = 
                    `<div style="font-size: 24px">${status.endpoints_active || 8}</div>API ÙØ¹Ø§Ù„`;
                
                document.getElementById('activeSessions').innerHTML = 
                    `<div style="font-size: 24px">${health.version}</div>Ù†Ø³Ø®Ù‡ Ø³ÛŒØ³ØªÙ…`;
                
                document.getElementById('responseTimeAvg').innerHTML = 
                    `<div style="font-size: 24px">${health.ai_enabled ? 'ÙØ¹Ø§Ù„' : 'Ø´Ø¨ÛŒÙ‡â€ŒØ³Ø§Ø²ÛŒ'}</div>Ø­Ø§Ù„Øª AI`;
                
            } catch (error) {
                console.error('Ø®Ø·Ø§ Ø¯Ø± Ø¨Ø§Ø±Ú¯Ø°Ø§Ø±ÛŒ Ø¢Ù…Ø§Ø±:', error);
            }
        }
        
        async function testApi() {
            const endpoint = document.getElementById('endpointSelect').value;
            const requestBody = document.getElementById('requestBody').value;
            const responseBox = document.getElementById('apiResponse');
            
            responseBox.textContent = 'Ø¯Ø± Ø­Ø§Ù„ Ø§Ø±Ø³Ø§Ù„...';
            
            try {
                let response;
                if (requestBody) {
                    response = await fetch(endpoint, {
                        method: 'POST',
                        headers: {'Content-Type': 'application/json'},
                        body: requestBody
                    });
                } else {
                    response = await fetch(endpoint);
                }
                
                const data = await response.json();
                responseBox.textContent = JSON.stringify(data, null, 2);
                responseBox.style.color = 'green';
                
            } catch (error) {
                responseBox.textContent = 'Ø®Ø·Ø§: ' + error.message;
                responseBox.style.color = 'red';
            }
        }
        
        async function learnResponse() {
            const question = document.getElementById('newQuestion').value;
            const answer = document.getElementById('newAnswer').value;
            
            if (!question || !answer) {
                alert('Ù„Ø·ÙØ§Ù‹ Ø³ÙˆØ§Ù„ Ùˆ Ù¾Ø§Ø³Ø® Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯');
                return;
            }
            
            try {
                const response = await fetch('/api/learn-response', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({question, answer})
                });
                
                const data = await response.json();
                alert(data.message);
                
                document.getElementById('newQuestion').value = '';
                document.getElementById('newAnswer').value = '';
                
            } catch (error) {
                alert('Ø®Ø·Ø§ Ø¯Ø± ÛŒØ§Ø¯Ú¯ÛŒØ±ÛŒ Ù¾Ø§Ø³Ø®');
            }
        }
        
        async function listResponses() {
            try {
                const response = await fetch('/api/list-responses');
                const data = await response.json();
                
                const responsesList = document.getElementById('responsesList');
                let html = '<h4>Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§ÛŒ ÛŒØ§Ø¯Ú¯Ø±ÙØªÙ‡ Ø´Ø¯Ù‡:</h4>';
                
                for (const [question, answer] of Object.entries(data.responses || {})) {
                    html += `<p><strong>${question}:</strong> ${answer}</p>`;
                }
                
                responsesList.innerHTML = html;
                
            } catch (error) {
                alert('Ø®Ø·Ø§ Ø¯Ø± Ø¯Ø±ÛŒØ§ÙØª Ù„ÛŒØ³Øª Ù¾Ø§Ø³Ø®â€ŒÙ‡Ø§');
            }
        }
        
        function clearAllMemory() {
            if (confirm('Ø¢ÛŒØ§ Ù…Ø·Ù…Ø¦Ù† Ù‡Ø³ØªÛŒØ¯ Ú©Ù‡ Ù…ÛŒâ€ŒØ®ÙˆØ§Ù‡ÛŒØ¯ ØªÙ…Ø§Ù… Ø­Ø§ÙØ¸Ù‡ Ø³ÛŒØ³ØªÙ… Ø±Ø§ Ù¾Ø§Ú© Ú©Ù†ÛŒØ¯ØŸ')) {
                alert('Ø§ÛŒÙ† Ù‚Ø§Ø¨Ù„ÛŒØª Ù†ÛŒØ§Ø² Ø¨Ù‡ Ù¾ÛŒØ§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Ø¯Ø± Ø³Ù…Øª Ø³Ø±ÙˆØ± Ø¯Ø§Ø±Ø¯.');
                // Ø¯Ø± Ø¢ÛŒÙ†Ø¯Ù‡: ÙØ±Ø§Ø®ÙˆØ§Ù†ÛŒ API Ø¨Ø±Ø§ÛŒ Ù¾Ø§Ú©Ø³Ø§Ø²ÛŒ Ø­Ø§ÙØ¸Ù‡
            }
        }
        
        function restartServer() {
            alert('Ø§ÛŒÙ† Ø¹Ù…Ù„Ú©Ø±Ø¯ Ù†Ù…Ø§Ø¯ÛŒÙ† Ø§Ø³Øª. Ø¯Ø± Ù†Ø³Ø®Ù‡â€ŒÙ‡Ø§ÛŒ Ø¨Ø¹Ø¯ÛŒ Ù¾ÛŒØ§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Ù…ÛŒâ€ŒØ´ÙˆØ¯.');
        }
        
        // Ú©Ù†ØªØ±Ù„ Ù…Ø­Ø¯ÙˆØ¯ÛŒØª Ø­Ø§ÙØ¸Ù‡
        document.getElementById('memoryLimit').addEventListener('input', function() {
            const value = this.value;
            document.getElementById('limitValue').textContent = value + ' Ù¾ÛŒØ§Ù…';
        });
    </script>
</body>
</html>
