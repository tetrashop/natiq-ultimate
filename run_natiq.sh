#!/bin/bash

echo "ðŸš€ Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ natiq-ultimate v6.0..."

# ØªØºÛŒÛŒØ± Ø¨Ù‡ Ø¯Ø§ÛŒØ±Ú©ØªÙˆØ±ÛŒ Ù¾Ø±ÙˆÚ˜Ù‡
cd ~/natiq-ultimate

# Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¬ÙˆØ¯ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø¶Ø±ÙˆØ±ÛŒ
echo "ðŸ” Ø¨Ø±Ø±Ø³ÛŒ ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ø¶Ø±ÙˆØ±ÛŒ..."
if [ ! -f "api/index.py" ]; then
    echo "âŒ ÙØ§ÛŒÙ„ api/index.py ÛŒØ§ÙØª Ù†Ø´Ø¯"
    exit 1
fi

if [ ! -d "public" ]; then
    echo "âŒ Ø¯Ø§ÛŒØ±Ú©ØªÙˆØ±ÛŒ public ÛŒØ§ÙØª Ù†Ø´Ø¯"
    exit 1
fi

# Ø§ÛŒØ¬Ø§Ø¯ Ø¯Ø§ÛŒØ±Ú©ØªÙˆØ±ÛŒ data Ø§Ú¯Ø± ÙˆØ¬ÙˆØ¯ Ù†Ø¯Ø§Ø±Ø¯
mkdir -p data
mkdir -p logs

# Ø¨Ø±Ø±Ø³ÛŒ ÙØ§ÛŒÙ„ Ø¯Ø§Ù†Ø´ Ù¾Ø§ÛŒÙ‡
if [ ! -f "data/knowledge_base.json" ]; then
    echo "ðŸ“ Ø§ÛŒØ¬Ø§Ø¯ ÙØ§ÛŒÙ„ Ø¯Ø§Ù†Ø´ Ù¾Ø§ÛŒÙ‡..."
    cat > data/knowledge_base.json << 'JSONEOF'
[
  {
    "id": 1,
    "question": "Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ Ú†ÛŒØ³ØªØŸ",
    "answer": "Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ (AI) Ø´Ø§Ø®Ù‡â€ŒØ§ÛŒ Ø§Ø² Ø¹Ù„ÙˆÙ… Ú©Ø§Ù…Ù¾ÛŒÙˆØªØ± Ø§Ø³Øª Ú©Ù‡ Ø¨Ù‡ Ø³Ø§Ø®Øª Ù…Ø§Ø´ÛŒÙ†â€ŒÙ‡Ø§ÛŒ Ù‡ÙˆØ´Ù…Ù†Ø¯ Ù…ÛŒâ€ŒÙ¾Ø±Ø¯Ø§Ø²Ø¯ Ú©Ù‡ Ù…ÛŒâ€ŒØªÙˆØ§Ù†Ù†Ø¯ Ú©Ø§Ø±Ù‡Ø§ÛŒÛŒ Ø±Ø§ Ø§Ù†Ø¬Ø§Ù… Ø¯Ù‡Ù†Ø¯ Ú©Ù‡ Ù…Ø¹Ù…ÙˆÙ„Ø§Ù‹ Ø¨Ù‡ Ù‡ÙˆØ´ Ø§Ù†Ø³Ø§Ù† Ù†ÛŒØ§Ø² Ø¯Ø§Ø±Ù†Ø¯.",
    "category": "Ù…ÙØ§Ù‡ÛŒÙ… Ù¾Ø§ÛŒÙ‡",
    "tags": ["ai", "Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ", "Ù…ÙØ§Ù‡ÛŒÙ…"]
  },
  {
    "id": 2,
    "question": "NLP Ú†ÛŒØ³ØªØŸ",
    "answer": "Ù¾Ø±Ø¯Ø§Ø²Ø´ Ø²Ø¨Ø§Ù† Ø·Ø¨ÛŒØ¹ÛŒ (NLP) Ø´Ø§Ø®Ù‡â€ŒØ§ÛŒ Ø§Ø² Ù‡ÙˆØ´ Ù…ØµÙ†ÙˆØ¹ÛŒ Ø§Ø³Øª Ú©Ù‡ Ø¨Ù‡ ØªØ¹Ø§Ù…Ù„ Ø¨ÛŒÙ† Ú©Ø§Ù…Ù¾ÛŒÙˆØªØ± Ùˆ Ø²Ø¨Ø§Ù† Ø§Ù†Ø³Ø§Ù† Ù…ÛŒâ€ŒÙ¾Ø±Ø¯Ø§Ø²Ø¯.",
    "category": "Ù¾Ø±Ø¯Ø§Ø²Ø´ Ø²Ø¨Ø§Ù†",
    "tags": ["nlp", "Ù¾Ø±Ø¯Ø§Ø²Ø´ Ø²Ø¨Ø§Ù†", "Ø²Ø¨Ø§Ù† Ø·Ø¨ÛŒØ¹ÛŒ"]
  }
]
JSONEOF
fi

# Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ø³Ø±ÙˆØ± API
echo "ðŸŒ Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ø³Ø±ÙˆØ± API Ø±ÙˆÛŒ Ù¾ÙˆØ±Øª 8000..."
echo "ðŸ“Š Ù„Ø§Ú¯ Ø³Ø±ÙˆØ± Ø¯Ø± api_server.log Ø°Ø®ÛŒØ±Ù‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯"
python3 -m uvicorn api.index:app --host 0.0.0.0 --port 8000 > api_server.log 2>&1 &
API_PID=$!

# ØµØ¨Ø± Ú©Ø±Ø¯Ù† Ø¨Ø±Ø§ÛŒ Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ø³Ø±ÙˆØ±
sleep 3

# Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¶Ø¹ÛŒØª Ø³Ø±ÙˆØ±
echo "ðŸ” Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¶Ø¹ÛŒØª Ø³Ø±ÙˆØ± API..."
if curl -s http://localhost:8000/api/health > /dev/null; then
    echo "âœ… Ø³Ø±ÙˆØ± API Ø¨Ø§ Ù…ÙˆÙÙ‚ÛŒØª Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ø´Ø¯"
    echo "ðŸ”— Ø¢Ø¯Ø±Ø³ API: http://localhost:8000/api/health"
    echo "ðŸ”— Ø¢Ø¯Ø±Ø³ Frontend: http://localhost:8000"
    echo "ðŸ”— Ø¢Ø¯Ø±Ø³ Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯: http://localhost:8000/dashboard.html"
    
    echo ""
    echo "ðŸ“‹ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø§ØªØµØ§Ù„:"
    echo "IP Ø¯Ø§Ø®Ù„ÛŒ: localhost ÛŒØ§ 127.0.0.1"
    echo "Ù¾ÙˆØ±Øª: 8000"
    echo ""
    echo "ðŸŽ® Ø¯Ø³ØªÙˆØ±Ø§Øª Ù…ÙÛŒØ¯:"
    echo "â€¢ Ø¨Ø±Ø±Ø³ÛŒ ÙˆØ¶Ø¹ÛŒØª: curl http://localhost:8000/api/health"
    echo "â€¢ Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ù„Ø§Ú¯: tail -f api_server.log"
    echo "â€¢ Ù…ØªÙˆÙ‚Ù Ú©Ø±Ø¯Ù†: kill $API_PID"
    
    # Ø¨Ø§Ø² Ú©Ø±Ø¯Ù† Ù…Ø±ÙˆØ±Ú¯Ø± (Ø§Ú¯Ø± Ø¯Ø± Ù…Ø­ÛŒØ· Ú¯Ø±Ø§ÙÛŒÚ©ÛŒ Ù‡Ø³ØªÛŒØ¯)
    if command -v xdg-open &> /dev/null; then
        xdg-open "http://localhost:8000" &
    elif command -v termux-open &> /dev/null; then
        termux-open "http://localhost:8000" &
    fi
    
    # Ø§Ù†ØªØ¸Ø§Ø± Ø¨Ø±Ø§ÛŒ Ø®Ø±ÙˆØ¬
    echo ""
    read -p "Ø¨Ø±Ø§ÛŒ Ù…ØªÙˆÙ‚Ù Ú©Ø±Ø¯Ù† Ø³Ø±ÙˆØ±ØŒ Enter Ø±Ø§ ÙØ´Ø§Ø± Ø¯Ù‡ÛŒØ¯... " -n 1
    kill $API_PID
    echo "â¹ Ø³Ø±ÙˆØ± Ù…ØªÙˆÙ‚Ù Ø´Ø¯"
else
    echo "âŒ Ø³Ø±ÙˆØ± API Ø±Ø§Ù‡â€ŒØ§Ù†Ø¯Ø§Ø²ÛŒ Ù†Ø´Ø¯"
    echo "ðŸ“„ Ù…Ø´Ø§Ù‡Ø¯Ù‡ Ù„Ø§Ú¯ Ø®Ø·Ø§:"
    tail -20 api_server.log
    kill $API_PID 2>/dev/null
    exit 1
fi
